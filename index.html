<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Candles - Sistema de Pedidos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .form-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .product-selector {
            display: grid;
            gap: 1rem;
        }

        .product-item {
            display: flex;
            gap: 1rem;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .product-item input[type="number"] {
            width: 80px;
        }

        .product-item select {
            flex: 1;
        }

        .remove-product {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .add-product-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            margin-top: 1rem;
        }

        .add-product-btn:hover {
            background: #764ba2;
        }

        .submit-btn {
            background: #10ac84;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
            margin-top: 1rem;
            font-weight: bold;
        }

        .submit-btn:hover {
            background: #0e9d73;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            flex: 1;
            padding: 1rem;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .orders-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-height: 700px;
            overflow-y: auto;
        }

        .order-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border-left: 5px solid #667eea;
        }

        .order-card.dispatched {
            border-left-color: #10ac84;
            opacity: 0.8;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .order-header h3 {
            color: #333;
            font-size: 1.2rem;
        }

        .order-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-pending {
            background: #ffeaa7;
            color: #d63031;
        }

        .status-dispatched {
            background: #55efc4;
            color: #00b894;
        }

        .order-details {
            color: #666;
            line-height: 1.8;
        }

        .order-details strong {
            color: #333;
        }

        .order-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .order-actions button {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .dispatch-btn {
            background: #10ac84;
            color: white;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #999;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .seller-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .seller-tag {
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® DREAM CANDLES</h1>
            <p>Sistema de Gesti√≥n de Pedidos</p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Pedidos</h3>
                <div class="number" id="totalOrders">0</div>
            </div>
            <div class="stat-card">
                <h3>Por Despachar</h3>
                <div class="number" id="pendingOrders">0</div>
            </div>
            <div class="stat-card">
                <h3>Despachados</h3>
                <div class="number" id="dispatchedOrders">0</div>
            </div>
            <div class="stat-card">
                <h3>Total Ventas</h3>
                <div class="number" id="totalSales">$0</div>
            </div>
        </div>

        <div class="main-content">
            <!-- Form Section -->
            <div class="form-section">
                <h2>üìù Nuevo Pedido</h2>
                <form id="orderForm">
                    <div class="form-group">
                        <label>Nombre del Cliente *</label>
                        <input type="text" id="clientName" required placeholder="Ej: Juan P√©rez">
                    </div>

                    <div class="form-group">
                        <label>Tel√©fono del Cliente</label>
                        <input type="tel" id="clientPhone" placeholder="Ej: 300 123 4567">
                    </div>

                    <div class="form-group">
                        <label>Vendedor(es) *</label>
                        <select id="sellerSelect" multiple size="4" required>
                            <option value="Mar√≠a Garc√≠a">Mar√≠a Garc√≠a</option>
                            <option value="Carlos L√≥pez">Carlos L√≥pez</option>
                            <option value="Ana Mart√≠nez">Ana Mart√≠nez</option>
                            <option value="Pedro Rodr√≠guez">Pedro Rodr√≠guez</option>
                            <option value="Laura S√°nchez">Laura S√°nchez</option>
                        </select>
                        <small style="color: #666;">Mant√©n Ctrl/Cmd para seleccionar varios</small>
                    </div>

                    <div class="form-group">
                        <label>Productos *</label>
                        <div id="productsList" class="product-selector"></div>
                        <button type="button" class="add-product-btn" onclick="addProductRow()">+ Agregar Producto</button>
                    </div>

                    <div class="form-group">
                        <label>Descripci√≥n Adicional</label>
                        <textarea id="description" placeholder="Detalles especiales del pedido, instrucciones de entrega, etc."></textarea>
                    </div>

                    <button type="submit" class="submit-btn">üíæ Guardar Pedido</button>
                </form>
            </div>

            <!-- Orders Section -->
            <div>
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('pending')">üì¶ Por Despachar</button>
                    <button class="tab-btn" onclick="switchTab('dispatched')">‚úÖ Despachados</button>
                </div>
                <div class="orders-section" id="ordersContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // Products catalog
        const products = [
            { name: 'Lavanda Serena', price: 15.99 },
            { name: 'Rosa M√≠stica', price: 17.99 },
            { name: 'Vainilla Dreams', price: 14.99 },
            { name: 'Ocean Breeze', price: 16.99 },
            { name: 'Eucalipto Zen', price: 18.99 },
            { name: 'Flor de Cerezo', price: 17.99 }
        ];

        let orders = [];
        let currentTab = 'pending';
        let productCounter = 0;

        // Load orders from storage
        async function loadOrders() {
            try {
                const result = await window.storage.get('dream-candles-orders');
                if (result && result.value) {
                    orders = JSON.parse(result.value);
                }
            } catch (error) {
                console.log('No hay pedidos guardados');
                orders = [];
            }
            updateStats();
            renderOrders();
        }

        // Save orders to storage
        async function saveOrders() {
            try {
                await window.storage.set('dream-candles-orders', JSON.stringify(orders));
            } catch (error) {
                console.error('Error al guardar:', error);
            }
        }

        // Add product row
        function addProductRow() {
            productCounter++;
            const productsList = document.getElementById('productsList');
            const div = document.createElement('div');
            div.className = 'product-item';
            div.id = `product-${productCounter}`;
            div.innerHTML = `
                <select class="product-name" required>
                    <option value="">Seleccionar...</option>
                    ${products.map(p => `<option value="${p.name}" data-price="${p.price}">${p.name} - $${p.price}</option>`).join('')}
                </select>
                <input type="number" class="product-qty" min="1" value="1" placeholder="Cant." required>
                <button type="button" class="remove-product" onclick="removeProductRow(${productCounter})">üóëÔ∏è</button>
            `;
            productsList.appendChild(div);
        }

        // Remove product row
        function removeProductRow(id) {
            const element = document.getElementById(`product-${id}`);
            if (element) element.remove();
        }

        // Handle form submit
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const clientName = document.getElementById('clientName').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const sellerSelect = document.getElementById('sellerSelect');
            const sellers = Array.from(sellerSelect.selectedOptions).map(opt => opt.value);
            const description = document.getElementById('description').value;

            // Get products
            const productItems = document.querySelectorAll('.product-item');
            const orderProducts = [];
            let totalAmount = 0;

            productItems.forEach(item => {
                const nameSelect = item.querySelector('.product-name');
                const qty = parseInt(item.querySelector('.product-qty').value);
                const productName = nameSelect.value;
                const price = parseFloat(nameSelect.selectedOptions[0].dataset.price);
                
                if (productName && qty > 0) {
                    orderProducts.push({
                        name: productName,
                        quantity: qty,
                        price: price,
                        subtotal: price * qty
                    });
                    totalAmount += price * qty;
                }
            });

            if (sellers.length === 0) {
                alert('Por favor selecciona al menos un vendedor');
                return;
            }

            if (orderProducts.length === 0) {
                alert('Por favor agrega al menos un producto');
                return;
            }

            // Create order
            const order = {
                id: Date.now(),
                clientName,
                clientPhone,
                sellers,
                products: orderProducts,
                description,
                totalAmount,
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            orders.push(order);
            await saveOrders();
            updateStats();
            renderOrders();

            // Reset form
            this.reset();
            document.getElementById('productsList').innerHTML = '';
            addProductRow();

            alert('‚úÖ Pedido registrado exitosamente!');
        });

        // Switch tab
        function switchTab(tab) {
            currentTab = tab;
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOrders();
        }

        // Render orders
        function renderOrders() {
            const container = document.getElementById('ordersContainer');
            const filteredOrders = orders.filter(o => o.status === currentTab);

            if (filteredOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>${currentTab === 'pending' ? 'üì¶' : '‚úÖ'}</h3>
                        <h3>No hay pedidos ${currentTab === 'pending' ? 'pendientes' : 'despachados'}</h3>
                        <p>Los pedidos aparecer√°n aqu√≠</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredOrders.map(order => `
                <div class="order-card ${order.status === 'dispatched' ? 'dispatched' : ''}">
                    <div class="order-header">
                        <h3>üë§ ${order.clientName}</h3>
                        <span class="order-status ${order.status === 'pending' ? 'status-pending' : 'status-dispatched'}">
                            ${order.status === 'pending' ? '‚è≥ Por Despachar' : '‚úÖ Despachado'}
                        </span>
                    </div>
                    <div class="order-details">
                        ${order.clientPhone ? `<p>üì± <strong>Tel√©fono:</strong> ${order.clientPhone}</p>` : ''}
                        <p>üë• <strong>Vendedor(es):</strong></p>
                        <div class="seller-tags">
                            ${order.sellers.map(s => `<span class="seller-tag">${s}</span>`).join('')}
                        </div>
                        <p style="margin-top: 1rem;">üõçÔ∏è <strong>Productos:</strong></p>
                        ${order.products.map(p => `
                            <p style="margin-left: 1rem;">‚Ä¢ ${p.name} x${p.quantity} - $${p.subtotal.toFixed(2)}</p>
                        `).join('')}
                        ${order.description ? `<p>üìù <strong>Descripci√≥n:</strong> ${order.description}</p>` : ''}
                        <p style="margin-top: 1rem; font-size: 1.2rem;"><strong>üí∞ Total: $${order.totalAmount.toFixed(2)}</strong></p>
                        <p style="font-size: 0.85rem; color: #999; margin-top: 0.5rem;">üìÖ ${new Date(order.createdAt).toLocaleString('es-ES')}</p>
                    </div>
                    <div class="order-actions">
                        ${order.status === 'pending' ? `
                            <button class="dispatch-btn" onclick="dispatchOrder(${order.id})">‚úÖ Marcar como Despachado</button>
                        ` : ''}
                        <button class="delete-btn" onclick="deleteOrder(${order.id})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        // Dispatch order
        async function dispatchOrder(orderId) {
            if (confirm('¬øMarcar este pedido como despachado?')) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    order.status = 'dispatched';
                    order.dispatchedAt = new Date().toISOString();
                    await saveOrders();
                    updateStats();
                    renderOrders();
                }
            }
        }

        // Delete order
        async function deleteOrder(orderId) {
            if (confirm('¬øEst√°s seguro de eliminar este pedido?')) {
                orders = orders.filter(o => o.id !== orderId);
                await saveOrders();
                updateStats();
                renderOrders();
            }
        }

        // Update stats
        function updateStats() {
            const pending = orders.filter(o => o.status === 'pending').length;
            const dispatched = orders.filter(o => o.status === 'dispatched').length;
            const totalSales = orders.reduce((sum, o) => sum + o.totalAmount, 0);

            document.getElementById('totalOrders').textContent = orders.length;
            document.getElementById('pendingOrders').textContent = pending;
            document.getElementById('dispatchedOrders').textContent = dispatched;
            document.getElementById('totalSales').textContent = `$${totalSales.toFixed(2)}`;
        }

        // Initialize
        addProductRow();
        loadOrders();
    </script>
</body>
</html>